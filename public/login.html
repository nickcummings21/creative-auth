<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src="http://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="stylesheets/style.css">

    <title>User Login</title>
</head>
<body>

    <h1>Login</h1>

    <label for="username-input"></label>
    <input type="text" id="username-input">
    <label for="pwd-input"></label>
    <input type="password" id="pwd-input">

    <button onclick="login()">login</button>
    <button onclick="register()">register</button>


    <script>

        let usernameInputEl = document.getElementById('username-input');
        let pwdInputEl = document.getElementById('pwd-input');

        function login() {
            // localStorage.user = JSON.stringify({ name: 'John'});
            // window.location = '/';

            let username = usernameInputEl.value;
            let pwd = pwdInputEl.value;

            if (username === '' || pwd === '') {
                alert('Invalid username or password.');
                return;
            }

            let query = '/get-user?username=' + username + '&pkey=' + pwd;
            $.getJSON(query, function (data) {
                console.log(data);
                localStorage.user = data.username;
                window.location = '/';
            });
        }

        function register() {

            let username = usernameInputEl.value;
            let pwd = pwdInputEl.value;

            if (username === '' || pwd === '') {
                alert('Invalid username or password.');
                return;
            }

            $.ajax({
                url: "register",
                type: "POST",
                data: JSON.stringify({ username: username, password: pwd }),
                contentType: "application/json; charset=utf-8",
                success: function(data, textStatus) {
                    console.log('Registered: ' + data);

                    localStorage.user = JSON.stringify({ username: username, password: pwd });
                    console.log(localStorage.user);
                    window.location = "/";
                }
            });
        }

    </script>

</body>
</html>